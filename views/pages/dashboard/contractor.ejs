<div class="dashboard">
  <div class="dashboard-header">
    <div>
      <h1>Welcome, <%= user.firstName %>! ðŸ‘·</h1>
      <p class="text-muted">Manage your contractor dashboard</p>
    </div>
    <% if (!contractor) { %>
      <a href="/contractors/setup" class="btn btn-primary">
        <i data-lucide="user-plus"></i>
        Complete Profile
      </a>
    <% } %>
  </div>
  
  <% if (!contractor) { %>
    <!-- Setup Profile CTA -->
    <div class="setup-cta">
      <div class="setup-icon">
        <i data-lucide="alert-circle"></i>
      </div>
      <div class="setup-content">
        <h3>Complete Your Professional Profile</h3>
        <p>Set up your contractor profile to start receiving project requests from homeowners.</p>
        <a href="/contractors/setup" class="btn btn-primary">
          <i data-lucide="arrow-right"></i>
          Set Up Now
        </a>
      </div>
    </div>
  <% } else { %>
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #00ff88, #00d4ff);">
          <i data-lucide="eye"></i>
        </div>
        <div class="stat-info">
          <span class="stat-value"><%= contractor.stats.profileViews || 0 %></span>
          <span class="stat-label">Profile Views</span>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #7c3aed, #a855f7);">
          <i data-lucide="folder"></i>
        </div>
        <div class="stat-info">
          <span class="stat-value"><%= contractor.stats.projectsReceived || 0 %></span>
          <span class="stat-label">Projects Received</span>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #ef4444);">
          <i data-lucide="check-circle"></i>
        </div>
        <div class="stat-info">
          <span class="stat-value"><%= contractor.stats.projectsAccepted || 0 %></span>
          <span class="stat-label">Projects Accepted</span>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #06b6d4, #3b82f6);">
          <i data-lucide="star"></i>
        </div>
        <div class="stat-info">
          <span class="stat-value"><%= contractor.rating.average || 'N/A' %></span>
          <span class="stat-label">Average Rating</span>
        </div>
      </div>
    </div>
    
    <!-- Availability Status -->
    <div class="dashboard-section">
      <div class="availability-card">
        <div class="availability-info">
          <h3>Your Availability</h3>
          <span class="availability-status status-<%= contractor.availability.status %>">
            <span class="status-dot"></span>
            <%= contractor.availability.status === 'available' ? 'Available for Projects' : 
                contractor.availability.status === 'busy' ? 'Busy - Limited Capacity' : 'Not Available' %>
          </span>
        </div>
        <a href="/contractors/profile/edit" class="btn btn-secondary btn-sm">
          <i data-lucide="settings"></i>
          Update
        </a>
      </div>
    </div>
    
    <!-- Available Projects -->
    <div class="dashboard-section">
      <div class="section-header-inline">
        <h2>Available Projects</h2>
        <a href="/contractors/projects/available" class="btn btn-ghost btn-sm">View All</a>
      </div>
      
      <% if (availableProjects && availableProjects.length > 0) { %>
        <div class="projects-list">
          <% availableProjects.forEach(project => { %>
            <div class="project-list-item">
              <div class="project-thumb">
                <% if (project.designVariants && project.designVariants.length > 0) { %>
                  <img src="<%= project.designVariants[0].imageUrl %>" alt="<%= project.title %>">
                <% } else { %>
                  <div class="placeholder-thumb">
                    <i data-lucide="image"></i>
                  </div>
                <% } %>
              </div>
              <div class="project-details">
                <h3><%= project.title %></h3>
                <div class="project-meta">
                  <span><i data-lucide="home"></i> <%= project.roomType %></span>
                  <span><i data-lucide="user"></i> <%= project.user.firstName %> <%= project.user.lastName.charAt(0) %>.</span>
                  <% if (project.budget && project.budget.max) { %>
                    <span><i data-lucide="euro"></i> Budget: â‚¬<%= project.budget.max.toLocaleString() %></span>
                  <% } %>
                </div>
                <p class="project-desc"><%= project.description.substring(0, 120) %>...</p>
              </div>
              <div class="project-actions-side">
                <a href="/projects/share/<%= project.shareToken %>" class="btn btn-secondary btn-sm">View Details</a>
                <button class="btn btn-primary btn-sm" onclick="expressInterest('<%= project._id %>')">
                  <i data-lucide="hand"></i> Express Interest
                </button>
              </div>
            </div>
          <% }) %>
        </div>
      <% } else { %>
        <div class="empty-state">
          <div class="empty-icon">
            <i data-lucide="search"></i>
          </div>
          <h3>No matching projects</h3>
          <p>Projects matching your specialties will appear here.</p>
        </div>
      <% } %>
    </div>
  <% } %>
</div>

<style>
  .dashboard {
    max-width: 1400px;
    margin: 0 auto;
    padding: var(--spacing-xl);
  }
  
  .dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-2xl);
  }
  
  .dashboard-header h1 {
    font-size: 1.75rem;
    margin-bottom: var(--spacing-xs);
  }
  
  .text-muted {
    color: var(--text-muted);
  }
  
  .setup-cta {
    display: flex;
    align-items: center;
    gap: var(--spacing-xl);
    padding: var(--spacing-2xl);
    background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 212, 255, 0.1));
    border: 1px solid rgba(0, 255, 136, 0.3);
    border-radius: var(--radius-xl);
    margin-bottom: var(--spacing-2xl);
  }
  
  .setup-icon {
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--accent-gradient);
    border-radius: 50%;
    color: #000;
    flex-shrink: 0;
  }
  
  .setup-icon i {
    width: 40px;
    height: 40px;
  }
  
  .setup-content h3 {
    font-size: 1.25rem;
    margin-bottom: var(--spacing-sm);
  }
  
  .setup-content p {
    color: var(--text-secondary);
    margin-bottom: var(--spacing-lg);
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-2xl);
  }
  
  .stat-card {
    display: flex;
    align-items: center;
    gap: var(--spacing-lg);
    padding: var(--spacing-xl);
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
  }
  
  .stat-icon {
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-md);
    color: #000;
  }
  
  .stat-icon i {
    width: 24px;
    height: 24px;
  }
  
  .stat-info {
    display: flex;
    flex-direction: column;
  }
  
  .stat-info .stat-value {
    font-size: 1.75rem;
    font-weight: 700;
    font-family: var(--font-display);
  }
  
  .stat-info .stat-label {
    font-size: 0.85rem;
    color: var(--text-muted);
  }
  
  .dashboard-section {
    margin-bottom: var(--spacing-2xl);
  }
  
  .section-header-inline {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
  }
  
  .section-header-inline h2 {
    font-size: 1.25rem;
  }
  
  .availability-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-xl);
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
  }
  
  .availability-info h3 {
    font-size: 1rem;
    margin-bottom: var(--spacing-sm);
  }
  
  .availability-status {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 0.9rem;
  }
  
  .status-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }
  
  .status-available .status-dot { background: var(--success); }
  .status-busy .status-dot { background: var(--warning); }
  .status-unavailable .status-dot { background: var(--error); }
  
  .projects-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
  }
  
  .project-list-item {
    display: flex;
    gap: var(--spacing-lg);
    padding: var(--spacing-lg);
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    transition: all var(--transition-base);
  }
  
  .project-list-item:hover {
    border-color: var(--border-color-hover);
  }
  
  .project-thumb {
    width: 120px;
    height: 100px;
    flex-shrink: 0;
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    overflow: hidden;
  }
  
  .project-thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .project-details {
    flex: 1;
  }
  
  .project-details h3 {
    font-size: 1.1rem;
    margin-bottom: var(--spacing-sm);
  }
  
  .project-meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
    color: var(--text-muted);
    font-size: 0.85rem;
  }
  
  .project-meta span {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    text-transform: capitalize;
  }
  
  .project-meta i {
    width: 14px;
    height: 14px;
  }
  
  .project-desc {
    font-size: 0.9rem;
    color: var(--text-secondary);
  }
  
  .project-actions-side {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    justify-content: center;
  }
  
  .empty-state {
    text-align: center;
    padding: var(--spacing-3xl);
    background: var(--bg-card);
    border: 1px dashed var(--border-color);
    border-radius: var(--radius-lg);
  }
  
  .empty-icon {
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-secondary);
    border-radius: 50%;
    margin: 0 auto var(--spacing-lg);
    color: var(--text-muted);
  }
  
  .empty-icon i {
    width: 40px;
    height: 40px;
  }
  
  .empty-state h3 {
    margin-bottom: var(--spacing-sm);
  }
  
  .empty-state p {
    color: var(--text-muted);
  }
  
  .placeholder-thumb {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: var(--text-muted);
  }
</style>

<script>
  function expressInterest(projectId) {
    const message = prompt('Enter a message for the client (optional):');
    if (message === null) return;
    
    const quotation = prompt('Enter your estimated quote (â‚¬) (optional):');
    
    fetch(`/contractors/projects/${projectId}/interest`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message, quotation })
    })
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        alert('Error: ' + data.error);
      } else {
        alert('Interest expressed successfully!');
        window.location.reload();
      }
    })
    .catch(() => alert('An error occurred'));
  }
</script>

