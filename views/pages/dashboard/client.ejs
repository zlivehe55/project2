<!-- Dashboard Header -->
<div class="dashboard-page-header">
  <div>
    <h1>Dashboard</h1>
    <p class="subtitle">Welcome back, <%= user.firstName %>. Here's your project overview.</p>
  </div>
  <div style="display: flex; gap: var(--spacing-sm);">
    <a href="/projects/new" class="btn btn-primary">
      <i data-lucide="plus"></i>
      New Project
    </a>
  </div>
</div>

<!-- Stats Row -->
<div class="stats-row">
  <div class="stat-card">
    <div class="stat-icon green">
      <i data-lucide="folder"></i>
    </div>
    <div class="stat-content">
      <div class="stat-value"><%= stats.totalProjects %></div>
      <div class="stat-label">Total Projects</div>
    </div>
  </div>
  
  <div class="stat-card">
    <div class="stat-icon purple">
      <i data-lucide="sparkles"></i>
    </div>
    <div class="stat-content">
      <div class="stat-value"><%= stats.totalVariants %></div>
      <div class="stat-label">AI Designs</div>
    </div>
  </div>
  
  <div class="stat-card">
    <div class="stat-icon orange">
      <i data-lucide="clock"></i>
    </div>
    <div class="stat-content">
      <div class="stat-value"><%= stats.inProgress %></div>
      <div class="stat-label">In Progress</div>
    </div>
  </div>
  
  <div class="stat-card">
    <div class="stat-icon blue">
      <i data-lucide="check-circle"></i>
    </div>
    <div class="stat-content">
      <div class="stat-value"><%= stats.completedDesigns %></div>
      <div class="stat-label">Completed</div>
    </div>
  </div>
</div>

<!-- Main Dashboard Grid -->
<div class="dashboard-grid">
  <!-- Left Column - Projects -->
  <div>
    <!-- AI Credits Card -->
    <div class="credits-card">
      <div class="credits-header">
        <h4><i data-lucide="zap"></i> AI Credits</h4>
        <a href="/pricing" class="btn btn-sm btn-ghost">Get More</a>
      </div>
      <div class="credits-value"><%= user.subscription?.credits || 3 %></div>
      <div class="credits-label"><%= user.isPremium ? 'Unlimited plan' : 'of 10 free credits' %></div>
      <% if (!user.isPremium) { %>
        <div class="credits-bar">
          <div class="credits-bar-fill" style="width: <%= ((user.subscription?.credits || 3) / 10) * 100 %>%"></div>
        </div>
      <% } %>
    </div>
    
    <!-- Recent Projects -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>Recent Projects</h2>
        <a href="/projects" class="btn btn-sm btn-ghost">View All</a>
      </div>
      
      <% if (projects && projects.length > 0) { %>
        <div class="projects-list">
          <% projects.slice(0, 5).forEach(project => { %>
            <a href="/projects/<%= project._id %>" class="project-item">
              <div class="project-thumb">
                <% if (project.designVariants && project.designVariants.length > 0) { %>
                  <img src="<%= project.designVariants[project.designVariants.length - 1].imageUrl || project.designVariants[project.designVariants.length - 1].thumbnailUrl %>" alt="<%= project.title %>">
                <% } else if (project.originalImages && project.originalImages.length > 0) { %>
                  <img src="<%= project.originalImages[0].url %>" alt="<%= project.title %>">
                <% } else { %>
                  <div class="project-thumb-placeholder">
                    <i data-lucide="image"></i>
                  </div>
                <% } %>
              </div>
              <div class="project-details">
                <h3><%= project.title %></h3>
                <div class="project-meta">
                  <span><i data-lucide="home"></i> <%= project.roomType %></span>
                  <% if (project.style) { %>
                    <span><i data-lucide="palette"></i> <%= project.style %></span>
                  <% } %>
                </div>
                <span class="project-status <%= project.status %>"><%= project.status %></span>
              </div>
            </a>
          <% }) %>
        </div>
      <% } else { %>
        <div class="section-content">
          <div class="empty-state">
            <div class="empty-state-icon">
              <i data-lucide="folder-plus"></i>
            </div>
            <h3>No projects yet</h3>
            <p>Create your first project and let AI transform your space</p>
            <a href="/projects/new" class="btn btn-primary">
              <i data-lucide="plus"></i>
              Create Project
            </a>
          </div>
        </div>
      <% } %>
    </div>
  </div>
  
  <!-- Right Column -->
  <div>
    <!-- Quick Actions -->
    <div class="dashboard-section" style="margin-bottom: var(--spacing-md);">
      <div class="section-header">
        <h2>Quick Actions</h2>
      </div>
      <div class="section-content">
        <div class="quick-actions-grid">
          <a href="/projects/new" class="quick-action">
            <i data-lucide="plus-circle"></i>
            <span>New Project</span>
          </a>
          <a href="/contractors" class="quick-action">
            <i data-lucide="hard-hat"></i>
            <span>Contractors</span>
          </a>
          <a href="/dashboard/messages" class="quick-action">
            <i data-lucide="message-square"></i>
            <span>Messages</span>
          </a>
          <a href="/gallery" class="quick-action">
            <i data-lucide="images"></i>
            <span>Gallery</span>
          </a>
        </div>
      </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>Recent Activity</h2>
      </div>
      <div class="activity-feed">
        <% if (recentActivity && recentActivity.length > 0) { %>
          <% recentActivity.forEach(activity => { %>
            <div class="activity-item">
              <div class="activity-icon">
                <% if (activity.type === 'design') { %>
                  <i data-lucide="sparkles" style="color: var(--accent-primary);"></i>
                <% } else if (activity.type === 'message') { %>
                  <i data-lucide="message-square" style="color: #3b82f6;"></i>
                <% } else { %>
                  <i data-lucide="folder" style="color: #8b5cf6;"></i>
                <% } %>
              </div>
              <div class="activity-content">
                <p><%= activity.message %></p>
                <span class="activity-time"><%= activity.time %></span>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <div class="section-content">
            <p style="color: var(--text-muted); text-align: center; font-size: 0.875rem;">No recent activity</p>
          </div>
        <% } %>
      </div>
    </div>
    
    <!-- Upgrade CTA -->
    <% if (!user.isPremium) { %>
      <div class="dashboard-section" style="margin-top: var(--spacing-md); background: linear-gradient(135deg, #f0fdf4, #ecfeff); border-color: rgba(16, 185, 129, 0.2);">
        <div class="section-content" style="text-align: center; padding: var(--spacing-lg);">
          <div style="font-size: 1.5rem; margin-bottom: var(--spacing-sm);">âš¡</div>
          <h3 style="font-size: 1rem; margin-bottom: var(--spacing-xs);">Upgrade to Pro</h3>
          <p style="color: var(--text-secondary); margin-bottom: var(--spacing-md); font-size: 0.8125rem;">
            Get unlimited AI generations and HD exports
          </p>
          <a href="/pricing" class="btn btn-primary btn-sm">
            Upgrade Now
          </a>
        </div>
      </div>
    <% } %>
  </div>
</div>
